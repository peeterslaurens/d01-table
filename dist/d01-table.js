!function(t){var e=t.module("d01-table",[]);e.filter("slice",function(){return function(t,e,a){return(t||[]).slice(e,a)}}),e.directive("d01Table",["$parse","$filter",function(e,a){return{templateUrl:"table.html",restrict:"AE",scope:{tablesource:"=source",tableconfig:"=config",onChange:"=",currentPage:"="},link:function(e,a,n){e.tablestatus={query:"",select:[],pages:0,activePage:0,itemsPerPage:0,sorting:{direction:"-",column:""},filteredData:[]},e.clickHeader=function(a){if(a.sortable){var n=t.copy(e.tablestatus.sorting);n.column===a.key?n.direction="-"===n.direction?"+":"-":(n.column=a.key,n.direction="+"),e.tablestatus.sorting=n}},e.pages=function(){return new Array(e.tablestatus.pages)},e.setPage=function(t){e.tablestatus.activePage=t,s(t)},e.prevPage=function(){e.tablestatus.activePage>0&&(e.tablestatus.activePage--,s(e.tablestatus.activePage))},e.nextPage=function(){e.tablestatus.activePage<e.tablestatus.pages-1&&(e.tablestatus.activePage++,s(e.tablestatus.activePage))},e.firstPage=function(){e.tablestatus.activePage>0&&(e.tablestatus.activePage=0,s(e.tablestatus.activePage))},e.lastPage=function(){e.tablestatus.activePage<e.tablestatus.pages-1&&(e.tablestatus.activePage=e.tablestatus.pages-1,s(e.tablestatus.activePage))},e.getStartItem=function(){return e.tableconfig.pagination&&!e.tableconfig.pagination.async?e.tablestatus.itemsPerPage*e.tablestatus.activePage:0},e.getEnditem=function(){return e.tableconfig.pagination?e.getStartItem()+e.tablestatus.itemsPerPage:1e4},e.selectFilter=function(t){var a=!0;return _.forEach(e.tableconfig.selects,function(n,i){n.filterKey&&e.tablestatus.select[i]&&l(t,n.filterKey)!==e.tablestatus.select[i]&&(a=!1)}),a};var l=function(t,e){var a=t,n=e.split(".");return _.forEach(n,function(t){a=a[t]}),a},i=function(){var t=e.tablestatus.filteredData.length;e.tablestatus.itemsPerPage=e.tableconfig.pagination.itemsPerPage,e.tableconfig.pagination.async&&(t=e.tableconfig.pagination.itemsLength),e.tablestatus.pages=Math.ceil(t/e.tablestatus.itemsPerPage)},s=function(){if(e.tableconfig.pagination&&e.tableconfig.pagination.async&&e.onChange){var t={page:e.tablestatus.activePage,start:null,end:null,sorting:e.tablestatus.sorting};t.start=(e.tablestatus.itemsPerPage-1)*e.tablestatus.activePage,t.end=t.start+(e.tablestatus.itemsPerPage-1),e.onChange(t)}},c=function(){e.parent=e.$parent,e.tableconfig.filter=e.tableconfig.filter||{},e.rowIdentifier=n.rowIdentifier,_.forEach(e.tableconfig.columns,function(t){t.defaultSort&&(e.tablestatus.sorting.column=t.key,e.tablestatus.sorting.direction="string"==typeof t.defaultSort?t.defaultSort||"-":e.tablestatus.sorting.direction)}),e.tableconfig.pagination&&i()};e.$on("setTablePage",function(t,a){e.setPage(parseInt(a))}),e.$watch("currentPage",function(t,a){t!==a&&t<e.tablestatus.pages&&(e.tablestatus.activePage=t,s())}),e.$watch("tablestatus.sorting",function(t,e){t!==e&&s()}),e.$watchGroup(["tablestatus.filteredData.length","tableconfig.pagination.itemsLength"],function(t,a){e.tableconfig.pagination&&i()}),c()}}}]).directive("d01Td",["$compile",function(t){return{templateUrl:"td.html",restrict:"A",scope:!1,transclude:!0,replace:!0,link:function(e,a,n){var l=e.$eval(n.config),i=e.$eval(n.source),s=function(t,e){t=t||window;var a=e,n=e.split(".");n=t[n[0]];for(var l=1,e=e.split("."),i=e.length;l<i;l++){if(null===n)return void console.warn("%s could not be found in your source object",a,t);n=n[e[l]]}return n},c=function(t,e,a){if(t&&e){var n='<span ng-bind="i.'+e;return a&&(n+=" | "+a),n+='"></span>'}return s(t,e)};if(l.template)a.append(l.template);else if(l.mode)switch(l.mode){case"date":moment?a.append(c(i,l.key,"date:'"+(l.dateFormat||"dd/MM/yy")+"'")):(console.warn("Date-mode was set, but moment.js is not availabe. Did you forget to include it in your app?"),a.append(c(i,l.key)));break;case"timeAgo":moment?a.append('<span am-time-ago="i.'+l.key+'"></span>'):(console.warn("Date-mode was set, but moment.js is not availabe. Did you forget to include it in your app?"),a.append(c(i,l.key)))}else a.append(c(i,l.key,l.filter));t(a.contents())(e)}}}])}(angular),angular.module("d01-table").run(["$templateCache",function(t){t.put("table.html",'<div class="d01-table-filter clearfix">\n    <div class="d01-table-filter-field" ng-if="tableconfig.searchField.enabled">\n        <label ng-bind="tableconfig.searchField.label"></label>\n        <input\n            type="text"\n            class="{{tableconfig.searchField.style.className}}"\n            placeholder="{{tableconfig.searchField.placeholder}}"\n            ng-model="tablestatus.query"\n            ng-class="{\n                \'col-9 first\': tableconfig.select.options && !tableconfig.searchField.style.override,\n                \'col-12\': !tableconfig.select.options && !tableconfig.searchField.style.override\n            }">\n    </div>\n    <div class="d01-table-filter-field" ng-repeat="select in tableconfig.selects track by $index" ng-if="select.options">\n        <label ng-bind="select.label"></label>\n        <select\n            class="{{select.style.className}}"\n            ng-model="tablestatus.select[$index]"\n            ng-options="option.value as option.name for option in select.options"\n            ng-class="{ \'col-3 last\': !select.style.override }"\n            >\n            <option value="" disabled="disabled">{{select.placeholder}}</option>\n        </select>\n    </div>\n</div>\n<table class="{{tableconfig.className}}">\n    <thead>\n        <th\n            ng-repeat="col in tableconfig.columns"\n            ng-click="clickHeader(col)"\n            ng-class="{ \'sortable\': col.sortable}"\n            class="{{\'field_\'+col.key + \' \'+ col.className}}"\n            >\n                {{col.columnName}} <i\n                    ng-if="col.sortable"\n                    class="fa"\n                    ng-class="{\n                        \'fa-angle-up\': tablestatus.sorting.column==col.key,\n                        \'fa-flip-vertical\': tablestatus.sorting.direction == \'-\' && tablestatus.sorting.column==col.key\n                    }"></i>\n            </th>\n    </thead>\n    <tbody>\n        <tr\n            ng-repeat="i in tablestatus.filteredData = (tablesource | filter:tablestatus.query | filter: selectFilter | orderBy:tablestatus.sorting.direction+tablestatus.sorting.column | filter:tableconfig.filter) | slice:getStartItem():getEnditem()"\n            ng-class-odd="\'odd\'"\n            ng-class-even="\'even\'"\n            class="{{(rowIdentifier) ? \'row_\'+i[rowIdentifier] : \'\'}}"\n            >\n                <td d01-td ng-repeat="col in tableconfig.columns" source="i" config="col"></td d01-td>\n        </tr>\n    </tbody>\n</table>\n<ul class="pagination" ng-if="tablestatus.pages > 1">\n    <li>\n        <a class="fa fa-angle-left" ng-click="prevPage()"></a>\n    </li>\n    <li ng-if="tablestatus.activePage > 4">\n        <a ng-click="firstPage()">1</a>\n    </li>\n    <li ng-if="tablestatus.activePage > 4">\n        <a ng-click="setPage(tablestatus.activePage - 5)">...</a>\n    </li>\n    <li ng-repeat="page in pages() track by $index" ng-if="($index >= (tablestatus.activePage - 4) && $index <= (tablestatus.activePage + 4))">\n        <a ng-class="{\'active\': $index == tablestatus.activePage}" ng-click="setPage($index)">{{$index + 1}}</a>\n    </li>\n    <li ng-if="tablestatus.activePage < pages().length - 5 && pages().length > 5">\n        <a ng-click="setPage(tablestatus.activePage + 5)">...</a>\n    </li>\n    <li ng-if="tablestatus.activePage < pages().length - 5 && pages().length > 5">\n        <a ng-click="lastPage()">{{pages().length}}</a>\n    </li>\n    <li>\n        <a class="fa fa-angle-right" ng-click="nextPage()"></a>\n    </li>\n</ul>\n'),t.put("td.html","<td class=\"{{'field_'+col.key+ ' ' + col.className}}\"></td>")}]);